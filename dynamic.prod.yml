http:
  
  middlewares: 
    
    dashboard-strip:
      stripPrefix:
        prefixes:
          - "/dashboard"

    api-strip:
      stripPrefix:
        prefixes:
          - "/api"

    # static-strip:
    #   stripPrefix:
    #     prefixes:
    #       - "/static"

    # https-redirect:
    #   redirectScheme:
    #     scheme: https
    #     permanent: true

  routers:
    
    api-router:
      rule: "Host(`testtestest.tw1.su`) && PathPrefix(`/api`)"
      entryPoints:
        - "web"
        - "websecure"
      middlewares:
        - "api-strip"
      service: "fastapi-service"
      priority: 100
    
    frontend-router:
      rule: "Host(`testtestest.tw1.su`)"
      entryPoints:
        - "web"
        - "websecure"
      service: "frontend-service"
      priority: 1

    dashboard-router:
      rule: "Host(`testtestest.tw1.su`) && PathPrefix(`/dashboard`)"
      entryPoints:
        - "websecure"
      middlewares:
        - "dashboard-strip"
      service: "api@internal"
      tls:
        certResolver: "myresolver"

    fastapi-router:
      rule: "Host(`testtestest.tw1.su`)"
      entryPoints:
        - "websecure"
      service: "fastapi-service"
      tls:
        certResolver: "myresolver"

  services:

    frontend-service:
      loadBalancer:
        servers:
          - url: "http://front:5173"
    
    fastapi-service:
      loadBalancer:
        servers:
          - url: "http://back:8000"